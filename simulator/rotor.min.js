(function(u,k,h){function r(a,b){var c=a.getBoundingClientRect();this.center=[c.left+c.width/2,c.top+c.height/2];this.radius=h.min(c.width,c.height);var d=this.inertia=!b||!1!==b.inertia,f,e,g,k,n,p,m=this;this[0]=a;this._3axisManip={down:function(a){f=l.vCalc(a.rotorX,a.rotorY,m.getRadius());e=m.aa;a.preventDefault()},move:function(a){a=l.vCalc(a.rotorX,a.rotorY,m.getRadius());a=l.aaCalc(f,a);a=l.aaProd(a,e);g=k;n=p;k=a.a;p=Date.now();m.rotation(a)},up:function(){if(d&&g){var a=k-g,c=p-n,b=m.aa,
e={x:b.x,y:b.y,z:b.z,a:b.a};s(function z(b){if(!m.down){var d=(b-p)/c*(a*=.9);p=b;e.a+=d;m.rotation(e);.01<h.abs(d)&&s(z)}})}g=0}};this.aa=v;this.on()}function w(a){var b=h.sqrt(a.x*a.x+a.y*a.y+a.z*a.z),c=a.a/2,b=h.sin(c)/b;return{x:a.x*b,y:a.y*b,z:a.z*b,w:h.cos(c)}}function x(a,b,c){var d,f,e,g;!c&&(c=a._3axisManip);for(d in c)f=c[d],e=A[d],g=e.e||a[0],f.ref="on"==b?B(a,g,d,e.m,f):g.removeEventListener(e.m,f.ref,!1)}function B(a,b,c,d,f){var e=function(b){if("down"==c||a.down){a.down="up"!=c;var d=
a.getCenter();b.rotorX=b.pageX-d[0];b.rotorY=b.pageY-d[1];f(b)}};b.addEventListener(d,e,!1);return e}for(var y=k.createElement("div").style,n=["O","ms","Webkit","Moz"],q=n.length,A={down:{m:"mousedown",t:"touchstart"},move:{m:"mousemove",t:"touchmove",e:k},up:{m:"mouseup",t:"touchend",e:k}},v={x:1,y:0,z:0,a:0},t,s,l;q--;)if(k=n[q]+"Transform",k in y){t=k;break}t&&n[q]+"Perspective"in y&&(s=u[n[q].toLowerCase()+"RequestAnimationFrame"],r.prototype={getCenter:function(){return this.center},getRadius:function(){return this.radius},
on:function(a){x(this,"on",a)},off:function(a){x(this,"off",a)},rotation:function(a){if(!a)return this.aa;this.aa=a;this[0].style[t]="rotate3d("+a.x+","+a.y+","+a.z+","+a.a+"rad)"}},l=function(a,b){return new r(a,b)},l.fn=r.prototype,l.vCalc=function(a,b,c){a/=c;b/=c;c=1-a*a-b*b;return{x:a,y:b,z:0<c?h.sqrt(c):0}},l.aaCalc=function(a,b){var c=a.y*b.z-a.z*b.y,d=a.z*b.x-a.x*b.z,f=a.x*b.y-a.y*b.x,e=h.acos((a.x*b.x+a.y*b.y+a.z*b.z)/(h.sqrt(a.x*a.x+a.y*a.y+a.z*a.z)*h.sqrt(b.x*b.x+b.y*b.y+b.z*b.z)));return e?
{x:c,y:d,z:f,a:e}:v},l.aaProd=function(a,b){var c=w(a),d=w(b),f=c.x*d.w+c.y*d.z-c.z*d.y+c.w*d.x,e=-c.x*d.z+c.y*d.w+c.z*d.x+c.w*d.y,g=c.x*d.y-c.y*d.x+c.z*d.w+c.w*d.z,d=-c.x*d.x-c.y*d.y-c.z*d.z+c.w*d.w;1<d&&(c=h.sqrt(f*f+e*e+g*g+d*d),f/=c,e/=c,g/=c,d/=c);c=2*h.acos(d);d=1-d*d;.001>d?(f=1,e=g=0):(d=h.sqrt(d),f/=d,e/=d,g/=d);return{x:f,y:e,z:g,a:c}},u.rotor=l)})(window,document,Math);
